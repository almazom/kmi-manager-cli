Data Flow (Manual Rotate + Proxy)

Manual Rotate
User
  -> kmi --rotate
  -> load_config (.env)
  -> load_auths_dir (_auths)
  -> load_state (~/.kmi/state.json)
  -> get_health_map (/usages)
  -> rotate_manual
  -> save_state + optional ~/.kimi/config.toml update
  -> render dashboard

Proxy Request
Client
  -> FastAPI proxy /kmi-rotor/v1/{path}
  -> authorize + rate limit
  -> select_key_for_request (round-robin if auto)
  -> inject Authorization header
  -> httpx to upstream
  -> record_request + mark_exhausted on 403/429
  -> append_trace + log_event
  -> response

E2E (optional)
User
  -> kmi e2e
  -> ensure proxy running
  -> send batches
  -> read trace.jsonl
  -> compute distribution/confidence
