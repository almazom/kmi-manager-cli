# Architecture Diagram

+-------------------------------+
| CLI (Typer)                   |
| - kmi --rotate/--auto_rotate  |
| - kmi --trace/--all/--health  |
| - kmi proxy                   |
+---------------+---------------+
                |
                v
+-------------------------------+
| Core Logic                    |
| config | keys | rotation      |
| health | state | trace | ui   |
| logging | auth_accounts       |
+-------+-----------------------+
        |                         \
        |                          \
        v                           v
+-------------------------------+  +--------------------------+
| Local Filesystem              |  | Local Proxy (FastAPI)    |
| - _auths/*.env                |  | /kmi-rotor/v1/{path}     |
| - ~/.kimi/config.toml         |  | httpx -> upstream        |
| - ~/.kmi/state.json           |  +--------------+-----------+
| - ~/.kmi/trace/trace.jsonl    |                 |
| - ~/.kmi/logs/kmi.log         |                 v
+-------------------------------+  +--------------------------+
                                   | Kimi API (Upstream)      |
                                   | /chat/completions        |
                                   | /models /usages          |
                                   +--------------------------+
