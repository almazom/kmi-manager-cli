# Meta Review - KMI Manager CLI (2026-01-29)

## Expert Bio
I am a systems reviewer with 30 years of experience spanning developer tools, API platform governance, and reliability engineering. Over three decades I have led code review programs, post-incident audits, and compliance assessments for CLI and proxy-based products in regulated environments. My work focuses on verifying assumptions, tracing risk to concrete code paths, and making review processes repeatable and evidence-driven. I have built and evaluated key rotation, telemetry, and proxy architectures across multiple providers and scale tiers.

## Review Process Assessment (Meta)
The prior review focused on domain risk and requirements, which is valuable for policy and operational posture. However, it leaned on requirements and inferred risks rather than verifying behavior in code or tests. The process also did not explicitly document what was validated vs assumed, which makes it harder to determine confidence levels for each claim.

## Assumption Validation (Evidence-Checked)
- Verified: Typer CLI entrypoint and options exist in `src/kmi_manager_cli/cli.py`.
- Verified: Rich UI usage is implemented in `src/kmi_manager_cli/ui.py`.
- Verified: FastAPI proxy with httpx forwarding exists in `src/kmi_manager_cli/proxy.py`.
- Verified: Key registry loads from `_auths` via `src/kmi_manager_cli/keys.py` and config defaults in `src/kmi_manager_cli/config.py`.
- Verified: Manual and auto rotation logic exists in `src/kmi_manager_cli/rotation.py` and is wired in `src/kmi_manager_cli/cli.py`.
- Verified: Health scoring uses `/usages` in `src/kmi_manager_cli/health.py`.
- Verified: Local state path defaults to `~/.kmi/state.json` in `src/kmi_manager_cli/state.py` and `src/kmi_manager_cli/config.py`.
- Verified: Logs are written to `~/.kmi/logs/kmi.log` in `src/kmi_manager_cli/logging.py`.
- Verified: Trace JSONL and TUI are implemented in `src/kmi_manager_cli/trace.py` and `src/kmi_manager_cli/trace_tui.py`.
- Verified: Pytest is configured in `pyproject.toml` and tests exist in `tests/`.
- Partially verified: A second path `~/.kimi/_auths` is used as a fallback in `src/kmi_manager_cli/config.py`, which may indicate a naming mismatch the review did not discuss.

## Reported Issues - Validation
- Confirmed: `Account` is referenced without an import in `src/kmi_manager_cli/cli.py`.
- Confirmed: `reset_line` is referenced but not defined in `src/kmi_manager_cli/ui.py`.
- Confirmed: No file locking or atomic writes for `state.json` or trace JSONL in `src/kmi_manager_cli/state.py` and `src/kmi_manager_cli/trace.py`.

## Blind Spots in the Review Process
- No execution evidence: The review did not run tests or linting, and did not document a non-execution rationale.
- No code-level verification: Several requirements and risks were inferred from docs without confirming actual behavior in code paths.
- Path consistency not checked: The review did not notice the mixed use of `~/.kmi` and `~/.kimi` across config and current-account lookup.
- Security posture not verified: The review called out redaction and retention, but did not inspect logs or traces to confirm current behavior.
- Proxy exposure not assessed: Binding defaults and access controls (e.g., local-only vs remote, auth on the proxy) were not verified.
- Failure mode analysis missing: There was no structured walk-through of error paths for `/usages`, upstream timeouts, or partial JSONL writes.

## Missing Checks to Add to the Review Playbook
- Test run checklist: `pytest` (and any async tests) should be executed or explicitly deferred with rationale.
- Config and path audit: Validate all filesystem locations, including `~/.kmi` vs `~/.kimi`, and document intended ownership.
- Concurrency audit: Check for atomic writes, file locking, and concurrent CLI/proxy access patterns.
- Security audit of logs/traces: Verify actual fields written, redaction of secrets, and log rotation behavior.
- Proxy safety audit: Confirm binding address, TLS expectations, auth/allowlist, and request size limits.
- Integration checks: Validate `/usages` behavior against real payloads and confirm graceful degradation when unavailable.

## Process Improvements
- Add an explicit Evidence section for each review, linking claims to concrete files and code paths.
- Separate risk hypotheses from verified findings, with a confidence tag per item.
- Include a minimal runtime validation step (tests or smoke run) and record outcomes.
