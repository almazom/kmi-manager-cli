# ğŸ¤– AOP v3.5 - Synthesized Task Document
## KMI Manager CLI - Expert Council Review
**Generated:** 2026-02-04 10:05:00 UTC  
**Council:** ğŸ§¹ ğŸ§Ÿ ğŸ§™ ğŸ”® ğŸ›ï¸ ğŸ›¡ï¸ (6 Experts)  
**Total Analysis Size:** 88,914 bytes

---

## ğŸ“Š Synthesis Summary

| Expert | Grade | Key Issues |
|--------|-------|------------|
| ğŸ§¹ Maintainability | B | 8 high-priority complexity issues |
| ğŸ§Ÿ Zombie Hunter | - | 7 security/async bugs |
| ğŸ§™ UX Seer | B+ | 3 critical UX blockers |
| ğŸ”® Meta Critic | B+ | Documentation crisis (12% coverage) |
| ğŸ›ï¸ Architecture (Rafael) | B- | 4 critical violations |
| ğŸ›¡ï¸ QA Guardian | â­â­â­â­â­ | Production-ready test coverage |

---

## ğŸ”´ HIGH-PRIORITY TASKS (P0 - Critical)

### TASK-001: Documentation Crisis [ğŸ”® Meta Critic]
**Issue:** Only ~12% docstring coverage; core modules have zero docstrings  
**Impact:** F grade for documentation on a B+ project  
**Action:**
- [ ] Add module docstrings to proxy.py, rotation.py, health.py
- [ ] Add function docstrings to all public APIs
- [ ] Document complex algorithms (_build_stay_reason, rotate_manual)
- [ ] Target: 80%+ docstring coverage
**Files:** src/kmi_manager_cli/*.py  
**Story Points:** 5

### TASK-002: God Object Proxy.py [ğŸ›ï¸ Architecture]
**Issue:** proxy.py is 907 lines with 35+ cyclomatic complexity  
**Impact:** Violates Single Responsibility, blocks safe modifications  
**Action:**
- [ ] Extract RateLimiter classes to proxy_limits.py
- [ ] Extract StateWriter/TraceWriter to proxy_writers.py  
- [ ] Extract error detection logic to proxy_errors.py
- [ ] Keep proxy.py as composition root only
**Files:** src/kmi_manager_cli/proxy.py (refactor)  
**Story Points:** 8

### TASK-003: Add Linting to CI [ğŸ”® Meta Critic]
**Issue:** GitHub Actions runs tests but not ruff linting  
**Impact:** Style issues and potential bugs slip through  
**Action:**
- [ ] Add `ruff check .` to CI workflow
- [ ] Add `ruff format --check` to CI
- [ ] Fix all existing linting issues
**Files:** .github/workflows/*.yml  
**Story Points:** 2

### TASK-004: Fix Dry-Run Confusion [ğŸ§™ UX Seer]
**Issue:** Users don't realize dry_run=True is default  
**Impact:** False sense of security, wasted debugging time  
**Action:**
- [ ] Add prominent warning banner on startup
- [ ] Add X-KMI-Dry-Run header to responses
- [ ] Update help text to highlight dry-run default
**Files:** src/kmi_manager_cli/config.py, proxy.py, cli.py  
**Story Points:** 2

### TASK-005: Deduplicate Rate Limiters [ğŸ§¹ Maintainability]
**Issue:** RateLimiter and KeyedRateLimiter share 90% identical code  
**Impact:** DRY violation, maintenance burden  
**Action:**
- [ ] Create base BaseRateLimiter class
- [ ] Refactor RateLimiter to extend base
- [ ] Refactor KeyedRateLimiter to extend base
- [ ] Maintain same public API
**Files:** src/kmi_manager_cli/proxy.py  
**Story Points:** 3

---

## ğŸŸ¡ MEDIUM-PRIORITY TASKS (P1 - Important)

### TASK-006: Circular Dependency Healthâ†”Rotation [ğŸ›ï¸ Architecture]
**Issue:** health.py imports from rotation.py; rotation.py imports from health.py  
**Action:** Extract shared types to models.py or protocols.py  
**Story Points:** 3

### TASK-007: Add Async Concurrency Tests [ğŸ›¡ï¸ QA Guardian]
**Issue:** Race conditions in StateWriter, TraceWriter undertested  
**Action:** Add tests for concurrent key selection, state mutations  
**Story Points:** 5

### TASK-008: Refactor UI Dashboard [ğŸ§¹ Maintainability]
**Issue:** render_accounts_health_dashboard() is 301 lines with 7-level nesting  
**Action:** Extract helper methods for each section  
**Story Points:** 3

### TASK-009: Security Hardening [ğŸ§Ÿ Zombie Hunter]
**Issues:**
- Missing explicit TLS verification
- Broad except clauses masking bugs
- Potential unbounded growth in KeyedRateLimiter
**Action:** Address security recommendations from Zombie Hunter report  
**Story Points:** 5

### TASK-010: Test Fixtures Refactoring [ğŸ›¡ï¸ QA Guardian]
**Issue:** High Config repetition in proxy tests  
**Action:** Create shared fixtures for common Config patterns  
**Story Points:** 2

---

## ğŸŸ¢ LOW-PRIORITY TASKS (P2 - Nice to Have)

### TASK-011: Add kmi init Command [ğŸ§™ UX Seer]
**Purpose:** Guided setup wizard for new users  
**Story Points:** 3

### TASK-012: Parametrized Tests [ğŸ›¡ï¸ QA Guardian]
**Purpose:** Use @pytest.mark.parametrize for HTTP status codes  
**Story Points:** 2

### TASK-013: Property-Based Testing [ğŸ›¡ï¸ QA Guardian]
**Purpose:** Consider hypothesis for rotation logic  
**Story Points:** 3

### TASK-014: Remove Coverage Exclusions [ğŸ”® Meta Critic]
**Issue:** cli.py, ui.py, trace_tui.py excluded from coverage  
**Action:** Add tests or justify exclusions  
**Story Points:** 5

---

## ğŸ“‹ IMPLEMENTATION ROADMAP

### Sprint 1 (Week 1): Foundation
1. TASK-003: Add linting to CI (2 SP)
2. TASK-001: Documentation - module docstrings (5 SP)
3. TASK-004: Fix dry-run confusion (2 SP)
**Total:** 9 SP

### Sprint 2 (Week 2): Refactoring
4. TASK-005: Deduplicate rate limiters (3 SP)
5. TASK-008: Refactor UI dashboard (3 SP)
6. TASK-002: Extract proxy modules - PART 1 (4 SP)
**Total:** 10 SP

### Sprint 3 (Week 3): Architecture
7. TASK-002: Extract proxy modules - PART 2 (4 SP)
8. TASK-006: Fix circular dependency (3 SP)
**Total:** 7 SP

### Sprint 4 (Week 4): Testing & Polish
9. TASK-007: Add async concurrency tests (5 SP)
10. TASK-010: Test fixtures refactoring (2 SP)
11. TASK-009: Security hardening (5 SP)
**Total:** 12 SP

**Grand Total:** 38 Story Points

---

## ğŸ¯ SUCCESS CRITERIA

- [ ] Documentation grade improves from F to B+
- [ ] proxy.py reduced from 907 to <500 lines
- [ ] CI passes with linting enabled
- [ ] No circular dependencies
- [ ] All P0 tasks completed
- [ ] 95%+ test coverage maintained
- [ ] All tests passing

---

## ğŸ“š SOURCE REPORTS

- `docs/review_library/01_maintainability.md` - ğŸ§¹ Maintainability Analysis
- `docs/review_library/02_zombie_hunter.md` - ğŸ§Ÿ Security & Bug Analysis
- `docs/review_library/03_ux_seer.md` - ğŸ§™ UX & Usability Analysis
- `docs/review_library/04_meta_critic.md` - ğŸ”® Meta Quality Analysis
- `docs/review_library/05_architecture.md` - ğŸ›ï¸ Architectural Analysis
- `docs/review_library/06_qa_guardian.md` - ğŸ›¡ï¸ Test Quality Analysis

---

*Generated by AOP v3.5 | Expert Council Synthesis*
