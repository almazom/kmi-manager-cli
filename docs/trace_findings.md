# Trace Findings (2026-01-30)

## Кратко
- `kmi --trace` показывает только запросы, которые реально проходят через прокси.
- `kimi` не читает `.env` проекта автоматически, поэтому без `KIMI_BASE_URL` он ходит напрямую в upstream.
- После отправки запроса через прокси строки в trace появляются с небольшой задержкой (около 5 секунд).

## Симптом
- В `kmi --trace` были только строки `/models` (старые тестовые запросы).
- Новые сообщения от `kimi` не появлялись в trace.

## Причина
- Команды `kimi ...` запускались без переменных окружения прокси.
- Поэтому запросы шли напрямую, минуя прокси и trace.

## Решение
Запускать `kimi` с явным указанием прокси:
```
export KIMI_BASE_URL="http://127.0.0.1:54123/kmi-rotor/v1"
export KIMI_API_KEY="proxy"

kimi --final-message-only --print --thinking -c "rr test"
```

## Проверка
- После запуска выше в `kmi --trace` появляется строка `/chat/completions`.
- В колонке текста отображается обрезанный prompt (например: `rr test`).
- Обновление может прийти с задержкой до ~5 секунд.

## Примечания
- `kmi --trace` читает файл `~/.kmi/trace/trace.jsonl`.
- Файл создаётся только после первых запросов через прокси.
